version: 2

models:

  - name: wh_web_events_fact
    description: >
      Each record in this table represents one user event, such as making an order, registering their account or interacting with marketing touchpoints. Marketing touchpoint interactions are sourced from Snowplow (with mobile app events eventually to be en)

    columns:
      - name: campaign_name
        description: A label for the campaign. For LinkedIn Ads this field is the `campaign_group_name` field.

  - name: wh_ad_campaign_performance_fact
    description: >
      Each record in this table represents one day of ad performance stats broken-down by ad network, ad campaign and ad group. Combines both the performance stats reported by the ad networks themselves with the actual "observed" stats from Snowplow. Matching is performed using (in priority order) the gclid/fbclid, if not present then the clid and if neither are present, the ad network/campaign/ad group IDs. Note that all of the logic for this model is in the int_ad_campaign_performance model, this fact table just passes those values through and adds a surrogate key (PK) to the model.
    columns:
      - name: campaign_name
        description: A label for the campaign. For LinkedIn Ads this field is the `campaign_group_name` field.
      - name: platform
        description: A label for the ad network.
      - name: reported_clicks
        description: The number of clicks generated by the campaign ad group, as provided by the ad network themselves.
      - name: reported_impressions
        description: The number of impressions generated by the campaign ad group, as provided by the ad network themselves.
      - name: reported_spend
        description: The total spend for the campaign ad group, as provided by the ad network themselves.
      - name: reported_cpc
        description: The average cost-per-click for the campaign ad group, as provided by the ad network themselves.
      - name: reported_cpm
        description: The average cost-per-impression for the campaign ad group, as provided by the ad network themselves.
      - name: actual_clicks
        description: The number of clicks generated by the campaign ad group, calculated via Snowplow from first events in session.
      - name: actual_cpc
        description: The average cost-per-click for the campaign ad group, using clicks from Snowplow and spend data from the ad networks.
      - name: actual_ctr
        description: The average click-through rate for the campaign ad group, using clicks from Snowplow and reported impressions data from the ad networks.
      - name: campaign_start_ts
        description: The earliest date in the warehouse for the given ad campaign, based on ad network dates but only as far back as our data extract.
      - name: ad_group_start_ts
        description: The earliest date in the warehouse for the given ad group, based on ad network dates but only as far back as our data extract.
      - name: days_since_campaign_start_ts
        description: Days since the earliest date in the warehouse for the given ad campaign, based on ad network dates but only as far back as our data extract.
      - name: days_since_ad_group_start_ts
        description: Days since the earliest date in the warehouse for the given ad group, based on ad network dates but only as far back as our data extract.

  - name: wh_ad_spend_roi_fact
    description: >
      Each record in this table represents one session (touchpoint) in a user's set of conversion journeys, joined to the ad campaign (+ adset) performance data relevant to the ad network, campaign and ad group that were responsible for that touchpoint (session). Note that not all rows from the web_session_fact or attribution_fact table are present in this model, only those that could be joined to ad network campaigns and ad groups in the ad_campaign_performance_fact table. Note also that if there were more than one touchpoint (session) for a given ad network ad campaign ad group group on a given day then the relevant records from the ad_campaign_performance_fact table will be joined to each touchpoint (session) row, leading to double-counting if you were to aggregate the ad spend, clicks and other ad network column values; therefore these will need to be aggregated using sum_distinct and avg_distinct aggregations in Looker for accurate RoI calculations to be possible; the reason this potential double-counting of ad network stats data was included in the model was to allow users of Looker to be able to "drill into" the touchpoints and conversions for a given days' ad network spend rather than have the spend at aggregate level only.

  - name: wh_attribution_fact
    description: >
      Each record in this table represents one touchpoint (session) in each user's set of conversion cycles. Not all sessions by all users will be found in this model as not all sessions (touchpoints) led to a conversion.
      This is a multi-cycle attribution model which means that we attribute the value of each order placed by a user to the sessions that led to that order, starting with the session after the last order.
      Each users' sessions are split into "conversion cycles", the set of sessions (touchpoints) leading-up to and potentially including the session in which the conversion happened.
      There can only be one conversion cycle for user registration conversions, and the same is true for first order conversions. Repeat order conversions start at conversion cycle #1 (if the user has made their second order) and then increment to #2 for the users' third order, etc.
      Every combination of attribution model and conversion type is pre-calculated for each session in the table, with Looker then displaying the one relevant to the user's query using parameters and liquid templating/variables.

    columns:
      - name: blended_user_id
        description: The custom user ID for each user, identity-stitched using the user's logged-in and unauthenticated sessions.
        meta:
          dimension:
            label: "User ID"
            type: number
            hidden: no
      - name: session_start_ts
      - name: session_end_ts
      - name: session_id
        description: Session ID either created by Snowplow or generated by this package for custom order/account opening sessions
      - name: web_session_pk
        description: Session Primary Key
      - name: session_seq
        description: Sequence number of the user's sessions, starting at 1
      - name: conversion_session
        description: Boolean value to indicate whether the session contained one or more conversion events
      - name: utm_source
      - name: utm_content
      - name: utm_medium
      - name: utm_campaign
      - name: platform
      - name: campaign_id
      - name: ad_group_id
      - name: referrer_host
      - name: referrer_domain
      - name: channel
        description: Marketing channel responsible for the user's session, based on custom Marketing Channel logic
      - name: first_order_total_revenue
        description: For sessions that included a first order conversion event, the total global currency revenue for that first order
      - name: first_order_total_lifetime_value_30d
        description: For sessions that included a first order conversion event, the total global currency 30 day revenue (spend) since their first order
      - name: first_order_total_lifetime_value_90d
        description: For sessions that included a first order conversion event, the total global currency 90 day revenue (spend) since their first order
      - name: first_order_total_lifetime_value_180d
        description: For sessions that included a first order conversion event, the total global currency 180 day revenue (spend) since their first order
      - name: first_order_total_lifetime_value_365d
        description: For sessions that included a first order conversion event, the total global currency 365 day revenue (spend) since their first order
      - name: currency_code
      - name: converted_ts
        description: Timestamp for the last conversion event in this session
      - name: min_converted_ts
        description: Timestamp for the first conversion event in this session
      - name: user_registration_conversion_cycle
        description: Sequence number of the user's account opening conversion cycle. Should contain either a 0 (the user has never opened an account within the timeframe of this dbt model's data extract) or 1 (the session is one that leads-up to or includes the account opening event)
      - name: user_first_order_conversion_cycle
        description: Sequence number of the user's first order conversion cycle. Should contain either a 0 (the user has never placed an order within the timeframe of this dbt model's data extract) or 1 (the session is one that leads-up to or includes the first order conversion event)
      - name: user_repeat_order_conversion_cycle
        description: Sequence number of the user's repeat order conversion cycle. Should contain either a 0 (the user has never placed an repeat order within the timeframe of this dbt model's data extract) or any number greater than 0 (the session is one that leads-up to or includes the repeat order conversion event for that repeat order conversion cycle)
      - name: is_within_attribution_lookback_window
        description: Boolean value to indicate whether the session was within the lookback window (range of days) for conversion events
      - name: is_within_attribution_time_decay_days_window
        description: Boolean value to indicate whether the session was within the lookback window (range of days) for time-decay calculations for the time decay attribution model.
      - name: is_non_direct_channel
        description: Boolean value to indicate whether the session was attributed to a non-direct channel, i.e. not direct.
      - name: is_paid_channel
        description: Boolean value to indicate whether the session was attributed to a paid channel, i.e. has "Paid" in the channel name.
      - name: time_decay_score
        description: The sessions' unweighted percentage share of the conversion event, used as input into the time decay attribution model calculations. Included For debugging purposes.
      - name: apportioned_time_decay_score
        description: Time decay score split equally amongst the sessions with each day over which conversions are being attributed via the time decay attribution model. Included For debugging purposes.
      - name: days_before_conversion
        description: Number of days to the conversion event, with 0 being the day of the conversion event. Included For debugging purposes.
      - name: time_decay_score_weighting
        description: Time decay score (equal split of the conversion over all days in the time decay attribution window) weighted by the 2 to the power of n time decay function. Included For debugging purposes.
      - name: time_decay_weighting_split_by_days_sessions
        description: Weighted overall time decay score for each day but split equally by all sessions in the day for a particular user.
      - name: count_order_conversions
        description: Total count of order conversions within the session.
      - name: count_repeat_order_conversions
        description: Total count of repeat order conversion events within the session.
      - name: count_registration_conversions
        description: Total count of account opening conversion events within the session.
      - name: first_click_attrib_pct
        description: Percentage of the conversion to attribute to the session using the First Click attribution model.
      - name: first_paid_click_attrib_pct
        description: Percentage of the conversion to attribute to the session using the First Paid Click attribution model.
      - name: last_click_attrib_pct
        description: Percentage of the conversion to attribute to the session using the Last Click attribution model.
      - name: last_paid_click_attrib_pct
        description: Percentage of the conversion to attribute to the session using the Last Paid Click attribution model.
      - name: even_click_attrib_pct
        description: Percentage of the conversion to attribute to the session using the Even Click attribution model.
      - name: time_decay_attrib_pct
        description: Percentage of the conversion to attribute to the session using the Time Decay attribution model.
      - name: user_registration_first_click_attrib_conversions
        description: Number of account opening conversions using the First Click Decay attribution model.
      - name: user_registration_first_non_direct_click_attrib_conversions
        description: Number of account opening conversions using the First Non-Direct Click attribution model.
      - name: user_registration_first_paid_click_attrib_conversions
        description: Number of account opening conversions using the First Paid Click attribution model.
      - name: user_registration_last_click_attrib_conversions
        description: Number of account opening conversions using the Last Click attribution model.
      - name: user_registration_last_non_direct_click_attrib_conversions
        description: Number of account opening conversions using the Last Non-Direct Click attribution model.
      - name: user_registration_last_paid_click_attrib_conversions
        description: Number of account opening conversions using the Last Paid Click attribution model.
      - name: user_registration_even_click_attrib_conversions
        description: Number of account opening conversions using the Even Click attribution model.
      - name: user_registration_time_decay_attrib_conversions
        description: Number of account opening conversions using the Time Decay attribution model.
      - name: first_order_first_click_attrib_conversions
        description: Number of first order conversions using the First Click attribution model.
      - name: first_order_first_non_direct_click_attrib_conversions
        description: Number of first order conversions using the First Non-Direct Click attribution model.
      - name: first_order_first_paid_click_attrib_conversions
        description: Number of first order conversions using the First Paid Click attribution model.
      - name: first_order_last_click_attrib_conversions
        description: Number of first order conversions using the Last Click attribution model.
      - name: first_order_last_non_direct_click_attrib_conversions
        description: Number of first order conversions using the Last Non-Direct Click attribution model.
      - name: first_order_even_click_attrib_conversions
        description: Number of first order conversions using the Even Click attribution model.
      - name: first_order_first_click_attrib_revenue
        meta:
          dimension:
            label: "First Order Even Click Revenue"
            type: number
            hidden: no
          metrics:
            total_first_order_even_click_revenue_global_currency:
              type: sum
              label: "Total First Order Even Click Revenue"
            avg_first_order_even_click_revenue_global_currency:
              type: average
              label: "Average First Order Even Click Revenue"
      - name: first_order_first_non_direct_click_attrib_revenue
      - name: first_order_first_paid_click_attrib_revenue
      - name: first_order_last_click_attrib_revenue
      - name: first_order_last_non_direct_click_attrib_revenue
      - name: first_order_last_paid_click_attrib_revenue
      - name: first_order_even_click_attrib_revenue
      - name: first_order_first_click_total_lifetime_value_30d
      - name: first_order_first_non_direct_click_total_lifetime_value_30d
      - name: first_order_last_click_total_lifetime_value_30d
      - name: first_order_last_non_direct_click_total_lifetime_value_30d
      - name: first_order_last_paid_click_total_lifetime_value_30d
      - name: first_order_even_click_total_lifetime_value_30d
      - name: first_order_time_decay_total_lifetime_value_30d
      - name: first_order_first_click_total_lifetime_value_60d
      - name: first_order_first_non_direct_click_total_lifetime_value_60d
      - name: first_order_last_click_total_lifetime_value_60d
      - name: first_order_last_non_direct_click_total_lifetime_value_60d
      - name: first_order_last_paid_click_total_lifetime_value_60d
      - name: first_order_even_click_total_lifetime_value_60d
      - name: first_order_time_decay_total_lifetime_value_60d
      - name: first_order_first_non_direct_click_total_lifetime_value_90d
      - name: first_order_last_non_direct_click_total_lifetime_value_90d
      - name: first_order_last_paid_click_total_lifetime_value_90d
      - name: first_order_even_click_total_lifetime_value_90d
      - name: first_order_time_decay_total_lifetime_value_90d
      - name: first_order_first_click_total_lifetime_value_180d
      - name: first_order_first_non_direct_click_total_lifetime_value_180d
      - name: first_order_last_click_total_lifetime_value_180d
      - name: first_order_last_non_direct_click_total_lifetime_value_180d
      - name: first_order_last_paid_click_total_lifetime_value_180d
      - name: first_order_even_click_total_lifetime_value_180d
      - name: first_order_time_decay_total_lifetime_value_180d
      - name: first_order_first_click_total_lifetime_value_365d
      - name: first_order_first_non_direct_click_total_lifetime_value_365d
      - name: first_order_last_click_total_lifetime_value_365d
      - name: first_order_last_non_direct_click_total_lifetime_value_365d
      - name: first_order_last_paid_click_total_lifetime_value_365d
      - name: first_order_even_click_total_lifetime_value_365d
      - name: first_order_time_decay_total_lifetime_value_365d
      - name: repeat_order_first_click_attrib_conversions
      - name: repeat_order_first_non_direct_click_attrib_conversions
      - name: repeat_order_last_click_attrib_conversions
      - name: repeat_order_last_non_direct_click_attrib_conversions
      - name: repeat_order_last_paid_click_attrib_conversions
      - name: repeat_order_even_click_attrib_conversions
      - name: repeat_order_time_decay_attrib_conversions
      - name: repeat_order_first_click_attrib_revenue
      - name: repeat_order_first_non_direct_click_attrib_revenue
      - name: repeat_order_first_paid_click_attrib_revenue
      - name: repeat_order_last_click_attrib_revenue
      - name: repeat_order_last_non_direct_click_attrib_revenue
      - name: repeat_order_last_paid_click_attrib_revenue
      - name: repeat_order_even_click_attrib_revenue
      - name: repeat_order_time_decay_attrib_revenue

  - name: wh_web_sessions_fact
    description: >
      Each record in this table represents one user session, with a session either being defined by custom using Snowplow and/or other logic, or by this package when we need to include an account opening or order transaction event in a user's conversion cycle, but the event happened outside of a Snowplow session and we had to create an artificial event in which to place it.
