version: 2

models:

  - name: wh_web_events_fact
    description: >
      Each record in this table represents one user event, such as making an order, registering their account or interacting with marketing touchpoints. Marketing touchpoint interactions are sourced from Snowplow (with mobile app events eventually to be en)

    columns:
      - name: campaign_name
        description: A label for the campaign. For LinkedIn Ads this field is the `campaign_group_name` field.

  - name: wh_ad_campaign_performance_fact
    description: >
      Each record in this table represents one day of ad performance stats broken-down by ad network, ad campaign and ad group. Combines both the performance stats reported by the ad networks themselves with the actual "observed" stats from Snowplow. Matching is performed using (in priority order) the gclid/fbclid, if not present then the clid and if neither are present, the ad network/campaign/ad group IDs. Note that all of the logic for this model is in the int_ad_campaign_performance model, this fact table just passes those values through and adds a surrogate key (PK) to the model.
    columns:
      - name: campaign_name
        description: A label for the campaign. For LinkedIn Ads this field is the `campaign_group_name` field.
      - name: platform
        description: A label for the ad network.
      - name: reported_clicks
        description: The number of clicks generated by the campaign ad group, as provided by the ad network themselves.
      - name: reported_impressions
        description: The number of impressions generated by the campaign ad group, as provided by the ad network themselves.
      - name: reported_spend
        description: The total spend for the campaign ad group, as provided by the ad network themselves.
      - name: reported_cpc
        description: The average cost-per-click for the campaign ad group, as provided by the ad network themselves.
      - name: reported_cpm
        description: The average cost-per-impression for the campaign ad group, as provided by the ad network themselves.
      - name: actual_clicks
        description: The number of clicks generated by the campaign ad group, calculated via Snowplow from first events in session.
      - name: actual_cpc
        description: The average cost-per-click for the campaign ad group, using clicks from Snowplow and spend data from the ad networks.
      - name: actual_ctr
        description: The average click-through rate for the campaign ad group, using clicks from Snowplow and reported impressions data from the ad networks.
      - name: campaign_start_ts
        description: The earliest date in the warehouse for the given ad campaign, based on ad network dates but only as far back as our data extract.
      - name: ad_group_start_ts
        description: The earliest date in the warehouse for the given ad group, based on ad network dates but only as far back as our data extract.
      - name: days_since_campaign_start_ts
        description: Days since the earliest date in the warehouse for the given ad campaign, based on ad network dates but only as far back as our data extract.
      - name: days_since_ad_group_start_ts
        description: Days since the earliest date in the warehouse for the given ad group, based on ad network dates but only as far back as our data extract.

  - name: wh_ad_spend_roi_fact
    description: >
      Each record in this table represents one session (touchpoint) in a user's set of conversion journeys, joined to the ad campaign (+ adset) performance data relevant to the ad network, campaign and ad group that were responsible for that touchpoint (session). Note that not all rows from the web_session_fact or attribution_fact table are present in this model, only those that could be joined to ad network campaigns and ad groups in the ad_campaign_performance_fact table. Note also that if there were more than one touchpoint (session) for a given ad network ad campaign ad group group on a given day then the relevant records from the ad_campaign_performance_fact table will be joined to each touchpoint (session) row, leading to double-counting if you were to aggregate the ad spend, clicks and other ad network column values; therefore these will need to be aggregated using sum_distinct and avg_distinct aggregations in Looker for accurate RoI calculations to be possible; the reason this potential double-counting of ad network stats data was included in the model was to allow users of Looker to be able to "drill into" the touchpoints and conversions for a given days' ad network spend rather than have the spend at aggregate level only.

  - name: wh_attribution_fact
    description: >
      Each record in this table represents one touchpoint (session) in each user's set of conversion cycles. Not all sessions by all users will be found in this model as not all sessions (touchpoints) led to a conversion.
      This is a multi-cycle attribution model which means that we attribute the value of each order placed by a user to the sessions that led to that order, starting with the session after the last order.
      Each users' sessions are split into "conversion cycles", the set of sessions (touchpoints) leading-up to and potentially including the session in which the conversion happened.
      There can only be one conversion cycle for user registration conversions, and the same is true for first order conversions. Repeat order conversions start at conversion cycle #1 (if the user has made their second order) and then increment to #2 for the users' third order, etc.
      Every combination of attribution model and conversion type is pre-calculated for each session in the table, with Looker then displaying the one relevant to the user's query using parameters and liquid templating/variables.

    columns:
      - name: blended_user_id
        description: The custom user ID for each user, identity-stitched using the user's logged-in and unauthenticated sessions.
        meta:
          dimension:
            label: "User ID"
            type: number
            hidden: no
      - name: session_start_ts
        meta:
          dimension:
            label: "Session Start"
            type: timestamp
            hidden: no
      - name: session_end_ts
        meta:
          dimension:
            label: "Session End"
            type: timestamp
            hidden: no
      - name: web_session_pk
        meta:
          dimension:
            label: "Session ID"
            type: timestamp
            hidden: no
        description: Session ID either created by Snowplow or generated by this package for custom order/account opening sessions
      - name: session_seq
        meta:
          dimension:
            label: "Session Sequence Number"
            type: timestamp
            hidden: no
        description: Sequence number of the user's sessions, starting at 1
      - name: conversion_session
        meta:
          dimension:
            label: "Is Conversion Session"
            type: boolean
            hidden: no
        description: Boolean value to indicate whether the session contained one or more conversion events
      - name: utm_source
        meta:
          dimension:
            label: "UTM Source"
            type: string
            hidden: no
      - name: utm_content
        meta:
          dimension:
            label: "UTM Content"
            type: string
            hidden: no
      - name: utm_medium
        meta:
          dimension:
            label: "UTM Medium"
            type: string
            hidden: no
      - name: utm_campaign
        meta:
          dimension:
            label: "UTM Campaign"
            type: string
            hidden: no
      - name: platform
        meta:
          dimension:
            label: "Ad Platform"
            type: string
            hidden: no
      - name: campaign_id
        meta:
          dimension:
            label: "Campaign ID"
            type: string
            hidden: no
      - name: ad_group_id
        meta:
          dimension:
            label: "Ad Group ID"
            type: string
            hidden: no
      - name: referrer_host
        meta:
          dimension:
            label: "Referrer Host"
            type: string
            hidden: no
      - name: referrer_domain
        meta:
          dimension:
            label: "Referrer Domain"
            type: string
            hidden: no
      - name: channel
        meta:
          dimension:
            label: "Marketing Channel"
            type: string
            hidden: no
        description: Marketing channel responsible for the user's session, based on custom Marketing Channel logic
      - name: currency_code
        meta:
          dimension:
            label: "Local Currency Code"
            type: string
            hidden: no
      - name: converted_ts
        description: Timestamp for the last conversion event in this session
        meta:
          dimension:
            label: "Conversion Timestamp"
            type: timestamp
            hidden: no
      - name: user_registration_conversion_cycle
        description: Sequence number of the user's account opening conversion cycle. Should contain either a 0 (the user has never opened an account within the timeframe of this dbt model's data extract) or 1 (the session is one that leads-up to or includes the account opening event)
        meta:
          dimension:
            label: "User Registration Conversion Cycle"
            type: number
            hidden: no
      - name: user_first_order_conversion_cycle
        description: Sequence number of the user's first order conversion cycle. Should contain either a 0 (the user has never placed an order within the timeframe of this dbt model's data extract) or 1 (the session is one that leads-up to or includes the first order conversion event)
        meta:
          dimension:
            label: "User First Order Conversion Cycle"
            type: number
            hidden: no
      - name: user_repeat_order_conversion_cycle
        description: Sequence number of the user's repeat order conversion cycle. Should contain either a 0 (the user has never placed an repeat order within the timeframe of this dbt model's data extract) or any number greater than 0 (the session is one that leads-up to or includes the repeat order conversion event for that repeat order conversion cycle)
        meta:
          dimension:
            label: "User Repeat Order Conversion Cycle"
            type: number
            hidden: no
      - name: count_repeat_order_conversions
        description: Total count of repeat order conversion events within the session.
        meta:
          dimension:
            label: "Total Repeat Orders"
            type: number
            hidden: no
      - name: count_registration_conversions
        description: Total count of account opening conversion events within the session.
        meta:
          dimension:
            label: "Total User Registrations"
            type: number
            hidden: no
      - name: user_registration_first_click_attrib_conversions
        description: Number of account opening conversions using the First Click Decay attribution model.
        meta:
          dimension:
            label: "Total First Click User Registrations"
            type: number
            hidden: no
      - name: user_registration_first_non_direct_click_attrib_conversions
        description: Number of account opening conversions using the First Non-Direct Click attribution model.
        meta:
          dimension:
            label: "Total First Non-Direct Click User Registrations"
            type: number
            hidden: no

      - name: user_registration_last_click_attrib_conversions
        description: Number of account opening conversions using the Last Click attribution model.
        dimension:
          label: "Total Last Click User Registrations"
          type: number
          hidden: no
      - name: user_registration_last_non_direct_click_attrib_conversions
        description: Number of account opening conversions using the Last Non-Direct Click attribution model.
        dimension:
          label: "Total Last Non-Direct Click User Registrations"
          type: number
          hidden: no
      - name: user_registration_last_paid_click_attrib_conversions
        description: Number of account opening conversions using the Last Paid Click attribution model.
        dimension:
          label: "Total Last Paid Click User Registrations"
          type: number
          hidden: no
      - name: user_registration_even_click_attrib_conversions
        description: Number of account opening conversions using the Even Click attribution model.
        dimension:
          label: "Total Even Click User Registrations"
          type: number
          hidden: no
      - name: user_registration_time_decay_attrib_conversions
        description: Number of account opening conversions using the Time Decay attribution model.
        dimension:
          label: "Total Time Decay User Registrations"
          type: number
          hidden: no
      - name: first_order_first_click_attrib_conversions
        description: Number of first order conversions using the First Click attribution model.
        dimension:
          label: "Total First Click First Orders"
          type: number
          hidden: no
      - name: first_order_first_non_direct_click_attrib_conversions
        description: Number of first order conversions using the First Non-Direct Click attribution model.
        dimension:
          label: "Total First Non-Direct Click First Orders"
          type: number
          hidden: no
      - name: first_order_first_paid_click_attrib_conversions
        description: Number of first order conversions using the First Paid Click attribution model.
        dimension:
          label: "Total First Paid Click First Orders"
          type: number
          hidden: no
      - name: first_order_last_click_attrib_conversions
        description: Number of first order conversions using the Last Click attribution model.
        dimension:
          label: "Total Last Click Orders"
          type: number
          hidden: no
      - name: first_order_last_non_direct_click_attrib_conversions
        description: Number of first order conversions using the Last Non-Direct Click attribution model.
        dimension:
          label: "Total Last Non-Direct Click First Orders"
          type: number
          hidden: no
      - name: first_order_even_click_attrib_conversions
        description: Number of first order conversions using the Even Click attribution model.
        dimension:
          label: "Total Even Click First Orders"
          type: number
          hidden: no
      - name: first_order_first_click_attrib_revenue
        meta:
        dimension:
          label: "Total Even Click First Order Revenue"
          type: number
          hidden: no
      - name: first_order_first_non_direct_click_attrib_revenue
        meta:
        dimension:
          label: "Total First Non-Direct Click First Order Revenue"
          type: number
          hidden: no
      - name: first_order_first_paid_click_attrib_revenue
        dimension:
          label: "Total First Paid Click First Order Revenue"
          type: number
          hidden: no
      - name: first_order_last_click_attrib_revenue
        dimension:
          label: "Total Last Click First Order Revenue"
          type: number
          hidden: no
      - name: first_order_last_non_direct_click_attrib_revenue
        dimension:
          label: "Total Last Non-Direct Click First Order Revenue"
          type: number
          hidden: no
      - name: first_order_last_paid_click_attrib_revenue
        dimension:
          label: "Total Last Paid Click First Order Revenue"
          type: number
          hidden: no
      - name: first_order_even_click_attrib_revenue
        dimension:
          label: "Total Even Click First Order Revenue"
          type: number
          hidden: no
      - name: repeat_order_first_click_attrib_conversions
        dimension:
          label: "Total First Click Repeat Orders"
          type: number
          hidden: no
      - name: repeat_order_first_non_direct_click_attrib_conversions
        dimension:
          label: "Total First Non-Direct Click Repeat Orders"
          type: number
          hidden: no
      - name: repeat_order_last_click_attrib_conversions
        dimension:
          label: "Total First Last Click Repeat Orders"
          type: number
          hidden: no
      - name: repeat_order_last_non_direct_click_attrib_conversions
        dimension:
          label: "Total Last Non-Direct Click Repeat Orders"
          type: number
          hidden: no
      - name: repeat_order_last_paid_click_attrib_conversions
        dimension:
          label: "Total Last Paid Click Repeat Orders"
          type: number
          hidden: no
      - name: repeat_order_even_click_attrib_conversions
        dimension:
          label: "Total Even Click Repeat Orders"
          type: number
          hidden: no
      - name: repeat_order_time_decay_attrib_conversions
        dimension:
          label: "Total Time Decay Repeat Orders"
          type: number
          hidden: no
      - name: repeat_order_first_click_attrib_revenue
        dimension:
          label: "Total First Click Repeat Order Revenue"
          type: number
          hidden: no
      - name: repeat_order_first_non_direct_click_attrib_revenue
        dimension:
          label: "Total First Non-Direct Repeat Order Revenue"
          type: number
          hidden: no
      - name: repeat_order_first_paid_click_attrib_revenue
        dimension:
          label: "Total First Paid Click Repeat Order Revenue"
          type: number
          hidden: no
      - name: repeat_order_last_click_attrib_revenue
        dimension:
          label: "Total Last Click Repeat Order Revenue"
          type: number
          hidden: no
      - name: repeat_order_last_non_direct_click_attrib_revenue
        dimension:
          label: "Total Last Non-Direct Click Repeat Order Revenue"
          type: number
          hidden: no
      - name: repeat_order_last_paid_click_attrib_revenue
        dimension:
          label: "Total Last Paid Click Repeat Order Revenue"
          type: number
          hidden: no
      - name: repeat_order_even_click_attrib_revenue
        dimension:
          label: "Total Even Click Repeat Order Revenue"
          type: number
          hidden: no
      - name: repeat_order_time_decay_attrib_revenue
        dimension:
          label: "Total Time Decay Repeat Order Revenue"
          type: number
          hidden: no

  - name: wh_web_sessions_fact
    description: >
      Each record in this table represents one user session, with a session either being defined by custom using Snowplow and/or other logic, or by this package when we need to include an account opening or order transaction event in a user's conversion cycle, but the event happened outside of a Snowplow session and we had to create an artificial event in which to place it.
